{% comment %}
  Video Testimonial Section with Video Slider
  Place this in: sections/video-testimonials.liquid
{% endcomment %}

<div class="testimonial-section">
  <div class="testimonial-container">
    
    <!-- Left Side: Video Slider -->
    <div class="video-slider-wrapper">
      <div class="video-slider" data-video-slider>
        <div class="video-slider-track">
          {% for block in section.blocks %}
            {% if block.type == 'video' %}
              <div class="video-slide" {{ block.shopify_attributes }}>
                {% if block.settings.video_type == 'youtube' and block.settings.youtube_url != blank %}
                  <!-- YouTube Video -->
                  <div class="video-container youtube-video" data-youtube-id="{{ block.settings.youtube_url | split: 'v=' | last | split: '&' | first }}">
                    <img 
                      src="https://img.youtube.com/vi/{{ block.settings.youtube_url | split: 'v=' | last | split: '&' | first }}/maxresdefault.jpg" 
                      alt="Video thumbnail"
                      class="video-thumbnail"
                    >
                    <div class="play-button">
                      <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
                        <circle cx="50" cy="50" r="50" fill="white" fill-opacity="0.95"/>
                        <path d="M40 30L70 50L40 70V30Z" fill="#7069bc"/>
                      </svg>
                    </div>
                  </div>
                {% elsif block.settings.video_type == 'shopify' and block.settings.shopify_video != blank %}
                  <!-- Shopify Hosted Video -->
                  <div class="video-container shopify-video paused">
                    {{ block.settings.shopify_video | video_tag: 
                      image_size: "1024x",
                      controls: false,
                      autoplay: false,
                      loop: true,
                      muted: true
                    }}
                    <button class="video-pause-play" aria-label="Play/Pause video">
                      <svg class="play-icon" viewBox="0 0 24 24" width="80" height="80">
                        <path d="M8 5v14l11-7z" fill="#ddcaf2"/>
                      </svg>
                      <svg class="pause-icon" viewBox="0 0 24 24" width="80" height="80" style="display: none;">
                        <path d="M6 4h4v16H6zm8 0h4v16h-4z" fill="#ddcaf2"/>
                      </svg>
                    </button>
                  </div>
                {% else %}
                  <!-- Placeholder -->
                  <div class="video-container video-placeholder">
                    <div class="placeholder-content">
                      <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                      </svg>
                      <p>Add video in settings</p>
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    
    <!-- Right Side: Content -->
    <div class="content-area">
      <h2 class="main-heading">
        {{ section.settings.heading }}
      
      </h2>
      <div>
          {% if section.settings.show_heart_icon %}
          <span class="heart-icon">ðŸ’œ</span>
        {% endif %}
      </div>

      
      <!-- Stats with Circular Progress -->
      <div class="stats-list">
        {% for block in section.blocks %}
          {% if block.type == 'stat' %}
            <div class="stat-item" {{ block.shopify_attributes }}>
              <div class="stat-circle" data-percentage="{{ block.settings.percentage }}">
                <svg class="circle-svg" width="80" height="80">
                  <circle class="circle-bg" cx="40" cy="40" r="35" />
                  <circle class="circle-progress" cx="40" cy="40" r="35" />
                </svg>
                <div class="percentage-text">
                  <span class="percentage-number">0</span>%
                </div>
              </div>
              <div class="stat-description">
                {{ block.settings.description }}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- Disclaimer -->
      {% if section.settings.disclaimer != blank %}
        <p class="disclaimer">{{ section.settings.disclaimer }}</p>
      {% endif %}
      
      <!-- CTA Button -->
      {% if section.settings.button_text != blank %}
        <div class="cta-wrapper">
          {% if section.settings.button_product != blank %}
            <a href="{{ section.settings.button_product.url }}" class="cta-button">
              {{ section.settings.button_text }}
            </a>
          {% else %}
            <a href="{{ section.settings.button_url }}" class="cta-button">
              {{ section.settings.button_text }}
            </a>
          {% endif %}
        </div>
      {% endif %}
      
      <!-- Reviews -->
      {% if section.settings.show_reviews %}
        <div class="reviews-section">
          <div class="stars">
            {% for i in (1..5) %}
              <svg class="star" width="20" height="20" viewBox="0 0 24 24" fill="#7069bc">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
              </svg>
            {% endfor %}
          </div>
          <p class="review-text">
            Excellent <strong>{{ section.settings.rating }}</strong> | {{ section.settings.review_count }} trusted reviews
          </p>
        </div>
      {% endif %}
    </div>
    
  </div>
</div>

<!-- YouTube Modal -->
<div class="youtube-modal" id="youtubeModal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <button class="modal-close" aria-label="Close">&times;</button>
    <div class="modal-video-wrapper">
      <iframe 
        id="youtubeIframe"
        width="100%" 
        height="100%" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
      </iframe>
    </div>
  </div>
</div>

<style>
  .testimonial-section {
    background: #fafafa;
    padding: 30px 0;
  }

  .testimonial-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
  }

  /* Video Slider */
  .video-slider-wrapper {
    position: relative;
    overflow: hidden;
  }

  .video-slider {
    overflow: hidden;
    position: relative;
  }

  .video-slider-track {
    display: flex;
    gap: 16px;
    transition: transform 0.5s ease-out;
    cursor: grab;
  }

  .video-slider-track:active {
    cursor: grabbing;
  }

  .video-slide {
    min-width: calc(50% - 8px);
    user-select: none;
  }

  .video-container {
    position: relative;
    aspect-ratio: 9 / 16;
    border-radius: 20px;
    overflow: hidden;
    background: #e0e0e0;
    cursor: pointer;
  }

  .youtube-video {
    position: relative;
  }

  .video-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.3s ease;
    pointer-events: none;
  }

  .video-container:hover .play-button {
    transform: translate(-50%, -50%) scale(1.1);
  }

  .shopify-video video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 20px;
  }

  .video-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #d0d0d0;
  }

  .placeholder-content {
    text-align: center;
    color: #666;
  }

  .placeholder-content svg {
    margin-bottom: 10px;
  }

  /* Pause/Play Button for Shopify Videos */
  .video-pause-play {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;
    transition: all 0.3s ease;
    opacity: 0;
  }

  .shopify-video:hover .video-pause-play,
  .shopify-video.paused .video-pause-play {
    opacity: 1;
  }

  .video-pause-play:hover {
    transform: translate(-50%, -50%) scale(1.1);
    background: rgba(255, 255, 255, 1);
  }

  /* Content Area */
  .content-area {
    padding: 20px 0;
  }

  .main-heading {
    font-size: 40px;
    font-weight: 700;
    color: #2d2d3f;
    line-height: 1.2;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    margin: 0;
  }

  .heart-icon {
    font-size: 48px;
    line-height: 1;
    animation: heartbeat 1.5s ease-in-out infinite;
  }

  @keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    25% { transform: scale(1.1); }
    50% { transform: scale(1); }
  }

  /* Stats */
  .stats-list {
    display: flex;
    flex-direction: column;
    gap: 24px;
    padding-top: 30px;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .stat-circle {
    position: relative;
    width: 80px;
    height: 80px;
    flex-shrink: 0;
  }

  .circle-svg {
    transform: rotate(-90deg);
  }

  .circle-bg {
    fill: none;
    stroke: #e0e0e0;
    stroke-width: 8;
  }

  .circle-progress {
    fill: none;
    stroke: #7069bc;
    stroke-width: 8;
    stroke-linecap: round;
    stroke-dasharray: 220;
    stroke-dashoffset: 220;
    transition: stroke-dashoffset 2s ease-out;
  }

  .percentage-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 20px;
    font-weight: 700;
    color: #7069bc;
  }

  .percentage-number {
    font-size: 24px;
  }

  .stat-description {
    color: #666;
    font-size: 17px;
    line-height: 1.5;
    width: 295px !important;
  }

  /* Disclaimer */
  .disclaimer {
    font-size: 14px;
    line-height: 1.6;
  }

  /* CTA Button */
  .cta-wrapper {
    margin-bottom: 28px;
  }

  .cta-button {
    display: inline-block;
    background: #7069bc;
    color: #ffffff;
    padding: 12px 30px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 900;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(139, 122, 184, 0.3);
  }

  .cta-button:hover {
    background: #7a6aa3;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(139, 122, 184, 0.4);
  }

  /* Reviews */
  .reviews-section {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .stars {
    display: flex;
    gap: 4px;
  }

  .review-text {
    font-size: 16px;
    margin: 0;
  }

  .review-text strong {
    color: #2d2d3f;
    font-weight: 800;
  }

  /* YouTube Modal */
  .youtube-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
  }

  .youtube-modal.active {
    display: block;
  }

  .modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
  }

  .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 900px;
    aspect-ratio: 16 / 9;
  }

  .modal-close {
    position: absolute;
    top: -40px;
    right: 0;
    background: transparent;
    border: none;
    color: white;
    font-size: 40px;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 40px;
    height: 40px;
  }

  .modal-video-wrapper {
    width: 100%;
    height: 100%;
    background: #000;
  }

  /* Responsive */
  @media (max-width: 968px) {
    .testimonial-container {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .main-heading {
      font-size: 32px;
    }

    .video-slider-wrapper {
      order: 2;
    }

    .content-area {
      order: 1;
    }
  }

  @media (max-width: 640px) {
    .testimonial-section {
      padding: 60px 16px;
    }

    .main-heading {
      font-size: 28px;
    }

    .video-slide {
      min-width: calc(100% - 80px);
    }

    .video-slider-track {
      gap: 12px;
    }

    .stat-circle {
      width: 70px;
      height: 70px;
    }

    .circle-svg {
      width: 70px;
      height: 70px;
    }

    .percentage-number {
      font-size: 20px;
    }

    .stat-description {
      font-size: 14px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Video Slider with Drag Functionality
    const sliderWrappers = document.querySelectorAll('[data-video-slider]');
    
    sliderWrappers.forEach(wrapper => {
      const track = wrapper.querySelector('.video-slider-track');
      const slides = wrapper.querySelectorAll('.video-slide');
      
      if (!track || slides.length === 0) return;

      let currentIndex = 0;
      let isDragging = false;
      let startX = 0;
      let currentTranslate = 0;
      let prevTranslate = 0;
      let animationID;

      const slidesPerView = window.innerWidth <= 640 ? 1 : 2;
      const maxIndex = Math.max(0, slides.length - slidesPerView);

      function getPositionX(event) {
        return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
      }

      function setSliderPosition() {
        track.style.transform = `translateX(${currentTranslate}px)`;
      }

      function animation() {
        setSliderPosition();
        if (isDragging) requestAnimationFrame(animation);
      }

      function touchStart(index) {
        return function(event) {
          isDragging = true;
          startX = getPositionX(event);
          animationID = requestAnimationFrame(animation);
          track.style.transition = 'none';
        };
      }

      function touchMove(event) {
        if (isDragging) {
          const currentPosition = getPositionX(event);
          const movedBy = currentPosition - startX;
          currentTranslate = prevTranslate + movedBy;
        }
      }

      function touchEnd() {
        isDragging = false;
        cancelAnimationFrame(animationID);

        const movedBy = currentTranslate - prevTranslate;
        const slideWidth = slides[0].offsetWidth + 16;

        if (movedBy < -100 && currentIndex < maxIndex) {
          currentIndex++;
        } else if (movedBy > 100 && currentIndex > 0) {
          currentIndex--;
        }

        updateSlider();
      }

      function updateSlider() {
        const slideWidth = slides[0].offsetWidth;
        const gap = 16;
        const offset = -currentIndex * (slideWidth + gap);
        
        currentTranslate = offset;
        prevTranslate = offset;
        
        track.style.transition = 'transform 0.5s ease-out';
        track.style.transform = `translateX(${offset}px)`;
      }

      slides.forEach((slide, index) => {
        const touchStartHandler = touchStart(index);
        slide.addEventListener('mousedown', touchStartHandler);
        slide.addEventListener('touchstart', touchStartHandler);
      });

      window.addEventListener('mousemove', touchMove);
      window.addEventListener('touchmove', touchMove);
      window.addEventListener('mouseup', touchEnd);
      window.addEventListener('touchend', touchEnd);

      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          currentIndex = 0;
          prevTranslate = 0;
          currentTranslate = 0;
          updateSlider();
        }, 250);
      });

      updateSlider();
    });

    // Shopify Video Play/Pause Controls
    const shopifyVideos = document.querySelectorAll('.shopify-video');
    
    shopifyVideos.forEach(container => {
      const video = container.querySelector('video');
      const playPauseBtn = container.querySelector('.video-pause-play');
      const playIcon = playPauseBtn?.querySelector('.play-icon');
      const pauseIcon = playPauseBtn?.querySelector('.pause-icon');
      
      if (!video || !playPauseBtn) return;

      function togglePlayPause() {
        if (video.paused) {
          video.play();
          container.classList.remove('paused');
          playIcon.style.display = 'none';
          pauseIcon.style.display = 'block';
        } else {
          video.pause();
          container.classList.add('paused');
          playIcon.style.display = 'block';
          pauseIcon.style.display = 'none';
        }
      }

      playPauseBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        togglePlayPause();
      });

      video.addEventListener('click', (e) => {
        e.stopPropagation();
        togglePlayPause();
      });
    });

    // Animate circular progress on scroll
    const statCircles = document.querySelectorAll('.stat-circle');
    const observerOptions = {
      threshold: 0.5,
      rootMargin: '0px'
    };

    const animateCircle = (circle) => {
      const percentage = parseInt(circle.getAttribute('data-percentage'));
      const progressCircle = circle.querySelector('.circle-progress');
      const numberElement = circle.querySelector('.percentage-number');
      const circumference = 2 * Math.PI * 35;
      const offset = circumference - (percentage / 100) * circumference;

      setTimeout(() => {
        progressCircle.style.strokeDashoffset = offset;
      }, 100);

      let current = 0;
      const increment = percentage / 60;
      const timer = setInterval(() => {
        current += increment;
        if (current >= percentage) {
          current = percentage;
          clearInterval(timer);
        }
        numberElement.textContent = Math.round(current);
      }, 30);
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCircle(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    statCircles.forEach(circle => {
      observer.observe(circle);
    });

    // YouTube Video Modal
    const youtubeVideos = document.querySelectorAll('.youtube-video');
    const modal = document.getElementById('youtubeModal');
    const iframe = document.getElementById('youtubeIframe');
    const closeBtn = document.querySelector('.modal-close');
    const backdrop = document.querySelector('.modal-backdrop');

    youtubeVideos.forEach(video => {
      video.addEventListener('click', function() {
        const videoId = this.getAttribute('data-youtube-id');
        iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });

    const closeModal = () => {
      modal.classList.remove('active');
      iframe.src = '';
      document.body.style.overflow = '';
    };

    if (closeBtn) {
      closeBtn.addEventListener('click', closeModal);
    }

    if (backdrop) {
      backdrop.addEventListener('click', closeModal);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  });
</script>

{% schema %}
{
  "name": "Video Testimonials",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "The Future Is Hair-Free!"
    },
    {
      "type": "checkbox",
      "id": "show_heart_icon",
      "label": "Show Heart Icon",
      "default": true
    },
    {
      "type": "textarea",
      "id": "disclaimer",
      "label": "Disclaimer Text",
      "default": "* Results according to clinical/consumer studies. For more information refer to each product page."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "CLAIM OFFER"
    },
    {
      "type": "product",
      "id": "button_product",
      "label": "Button Product Link"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL (if no product selected)"
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show Reviews",
      "default": true
    },
    {
      "type": "text",
      "id": "rating",
      "label": "Rating",
      "default": "4.8"
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review Count",
      "default": "7,322"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "select",
          "id": "video_type",
          "label": "Video Type",
          "options": [
            {
              "value": "youtube",
              "label": "YouTube"
            },
            {
              "value": "shopify",
              "label": "Shopify Hosted"
            }
          ],
          "default": "youtube"
        },
        {
          "type": "text",
          "id": "youtube_url",
          "label": "YouTube URL",
          "info": "Full YouTube URL (e.g., https://www.youtube.com/watch?v=VIDEO_ID)"
        },
        {
          "type": "video",
          "id": "shopify_video",
          "label": "Shopify Video"
        }
      ]
    },
    {
      "type": "stat",
      "name": "Statistic",
      "settings": [
        {
          "type": "range",
          "id": "percentage",
          "label": "Percentage",
          "min": 0,
          "max": 100,
          "step": 1,
          "default": 95,
          "unit": "%"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Description",
          "default": "Said the appearance of their strawberry legs improved"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video Testimonials",
      "blocks": [
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "video"
        },
        {
          "type": "stat",
          "settings": {
            "percentage": 95,
            "description": "Said the appearance of their strawberry legs improved"
          }
        },
        {
          "type": "stat",
          "settings": {
            "percentage": 94,
            "description": "Noticed a reduction in the appearance of ingrown hairs"
          }
        },
        {
          "type": "stat",
          "settings": {
            "percentage": 90,
            "description": "Saw an improvement in the look of skin firmness"
          }
        }
      ]
    }
  ]
}
{% endschema %}